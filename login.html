<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="login.css">
    <title>Iniciar sesi칩n</title>
</head>
<body>
    <div class="CentrarDiv">
        <div id="divInpUser">
            <label for="usuario">Ingrese usuario</label>
            <input type="text" name="usuario" id="usuario">
        </div>
        <div id="divInpPass">
            <label for="psw">Ingrese su contrase침a</label>
            <input type="password" name="psw" id="psw">
        </div>
        <div>
            <button onclick="login()">Iniciar sesi칩n</button>	
        </div>
    </div>
    
    <script type="application/javascript">

        var ElementDivUser = document.getElementById("divInpUser");
        var ElementDivPass = document.getElementById("divInpPass");
        var ElementUser = document.getElementById("usuario");
        var ElementPass = document.getElementById("psw");

        this.inpUser = "";
        this.inpPass = "";

        var ValidatorTxtUser = document.createElement("p");
        var TextValUser = document.createTextNode("No sea wey e ingrese un usuario");
        ValidatorTxtUser.appendChild(TextValUser);
        
        var validatorPass = document.createElement("p");
        var TextValPass = document.createTextNode("No sea wey e ingrese una contrase침a");
        validatorPass.appendChild(TextValPass);

        ElementUser.addEventListener("input", function(){
            inpUser = ElementUser.value;
            if(inpUser === null || inpUser === '' || inpUser === undefined){
                ElementUser.after(ValidatorTxtUser);
            } else {
                console.log(ValidatorTxtUser.parentNode);
                ElementDivUser.removeChild(ValidatorTxtUser);
            }
        });

        ElementPass.addEventListener("input", function() {
            inpPass = ElementPass.value;
            if (inpPass === null || inpPass === '' || inpPass === undefined) {
                ElementPass.after(validatorPass);
            } else {
                console.log(validatorPass.parentNode);
                ElementDivPass.removeChild(validatorPass);
            }
        });

        function login() {

            if(inpUser === null || inpUser === '' || inpUser === undefined)
            {
                var focusedInpUser = document.getElementById("usuario");
                focusedInpUser.focus();
                ElementDivUser.appendChild(ValidatorTxtUser);
                ElementUser.after(ValidatorTxtUser);
                
            } else if (inpPass === null || inpPass === '' || inpPass === undefined) {
                var focusedInpPass = document.getElementById("psw");
                focusedInpPass.focus();
                ElementDivPass.appendChild(validatorPass);
                ElementPass.after(validatorPass);
            } else {
                var ObjParam = {
                    User: inpUser,
                    Pass: inpPass
                };

                fetch(window.location.origin + '/iniciar', {
                    method: 'POST',
                    headers:{
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(ObjParam) 
                }).then(
                    resp => resp.json()
                ).catch(
                    err => console.log('ocurrio un error', err)
                ).then(
                    data => MenuPrincipal(data)
                )
            }
        }

        function MenuPrincipal(Usuario) {
            if(Usuario.Existe) {
                localStorage.setItem('UsuarioApp', JSON.stringify(Usuario));
                window.location.replace(window.location.origin);
            } else {
                alert("El usuario no existe o verifique los datos");
            }
        }

        function ShowNotification(mensaje) {
            if(!("Notification" in window)) {
                alert("No soporta notificaciones");
            } else {
                Notification.requestPermission(function(permiso){
                    if (permiso === "granted") {
                        var notificacion = new Notification(mensaje);
                    } 
                });
            }
        }

    </script>
</body>
</html>