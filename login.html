<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="login.css">
    <title>Iniciar sesi칩n</title>
</head>
<body>
    <div class="CentrarDiv">
        <div>
            <label for="usuario">Ingrese usuario</label>
            <input type="text" name="usuario" id="usuario">
        </div>
        <div>
            <label for="psw">Ingrese su contrase침a</label>
            <input type="password" name="psw" id="psw">
        </div>
        <div>
            <button onclick="login()">Iniciar sesi칩n</button>	
        </div>
    </div>
    
    <script type="application/javascript">

        function login() {
            var inpUser = document.getElementById("usuario").value;
            var inpPass = document.getElementById("psw").value;

            if(inpUser === null || inpUser === '' || inpUser === undefined)
            {
                var focusedInpUser = document.getElementById("usuario");
                focusedInpUser.focus();
                ShowNotification("No sea wey y escriba un usuario");
            } else if (inpPass === null || inpPass === '' || inpPass === undefined) {
                var focusedInpPass = document.getElementById("psw");
                focusedInpPass.focus();
                ShowNotification("No sea wey y escriba la contrase침a");
            } else {
                var ObjParam = {
                    User: inpUser,
                    Pass: inpPass
                };

                fetch(window.location.origin + '/iniciar', {
                    method: 'POST',
                    headers:{
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(ObjParam) 
                }).then(
                    resp => resp.json()
                ).catch(
                    err => console.log('ocurrio un error', err)
                ).then(
                    data => MenuPrincipal(data)
                )
            }
        }

        function MenuPrincipal(Usuario) {
            if(Usuario.Existe) {
                localStorage.setItem('UsuarioApp', JSON.stringify(Usuario));
                window.location.replace(window.location.origin);
            } else {
                alert("El usuario no existe o verifique los datos");
            }
        }

        function ShowNotification(mensaje) {
            if(!("Notification" in window)) {
                alert("No soporta notificaciones");
            } else {
                Notification.requestPermission(function(permiso){
                    if (permiso === "granted") {
                        var notificacion = new Notification(mensaje);
                    } 
                });
            }
        }

    </script>
</body>
</html>